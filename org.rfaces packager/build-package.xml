<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="Packager Camelia" default="main" basedir=".">
	<property name="dist" value="${basedir}/dist" />
	<property name="build" value="${basedir}/build" />
	<property name="java.target" value="1.5" />
	<property name="integration.type" value="I" />
	<property name="cvstag" value="HEAD" />

	<property name="generator.classpath.dir" value="lib-generator/generator.jar" />

	<path id="commons.classpath">
		<fileset dir="lib">
			<include name="*.jar" />
		</fileset>
	</path>

	<path id="generator.classpath">
		<pathelement location="${generator.classpath.dir}" />
		<fileset dir="lib-generator">
			<include name="*.jar" />
			<exclude name="generator.jar" />
		</fileset>
		<path refid="commons.classpath"/>
	</path>

	<target name="buildNewStream" unless="branch.version">
		<tstamp>
			<format property="build.number" pattern="yyyyMMddHHmm" locale="fr" />
		</tstamp>
	</target>

	<target name="buildNewIntegration" unless="branch.version">
		<buildnumber file="${dist}/build-number" />
	</target>

	<target name="buildHead" unless="branch.version">
		<property name="build-core" location="${basedir}/../org.rcfaces.core" />
		<property name="build-html" location="${basedir}/../org.rcfaces.renderkit.html" />
		<property name="build-imageIO" location="${basedir}/../org.rcfaces.image.imageIO" />
		<property name="build-svg" location="${basedir}/../org.rcfaces.renderkit.svg" />
		<property name="build-jfreechart" location="${basedir}/../org.rcfaces.jfreechart" />

		<property name="metadas.xml.core" location="${build-core}/metadatas" />
		<property name="metadas.xml.html" location="${build-html}/metadatas" />
		<property name="metadas.xml.svg" location="${build-svg}/metadatas" />

		<echo message="Build new version dir ${dist}" />
		<echo message="Set version to ${integration.type}${build.number}" />
		<property name="integrationVersion" value="${build.number}" />
		<tstamp>
			<format property="TODAY" pattern="dd/MM/yyyy HH:mm " locale="fr" />
		</tstamp>

	</target>

	<target name="buildBranchVersion" if="branch.version">
		<echo message="Build branch version dist=${dist}" />

<!--		<buildnumber file="${dist}/build-number_b${branch.version}" /> -->
		<property name="integrationVersion" value="${branch.version}.${build.number}" />

		<property name="build-core" location="${basedir}/../org.rcfaces.core" />
		<property name="build-html" location="${basedir}/../org.rcfaces.renderkit.html" />

		<property name="metadas.xml.core" location="${build-core}/metadatas" />
		<property name="metadas.xml.html" location="${build-html}/metadatas" />

		<tstamp>
			<format property="TODAY" pattern="dd/MM/yyyy HH:mm " locale="fr" />
		</tstamp>

	</target>

	<target name="clean">
		<delete dir="${build}" failonerror="false" />
		<delete file="${dist}/rcfaces*.jar" failonerror="false" />
		<delete failonerror="false">
			<fileset dir="${build-html}/src-generated/org/rcfaces/renderkit/html/internal/javascript" includes="**/*.jsc,symbolsc,symbols" />
			<fileset dir="${build-html}/bin/org/rcfaces/renderkit/html/internal/javascript" includes="**/*.jsc,symbolsc,symbols" />
		</delete>
	</target>

	<target name="compileJS">
		<delete failonerror="false" >
			<fileset dir="${build}/js_optimizer*"/>
		</delete>

		<java taskname="OptimizeJs Level1" classname="com.vedana.camelia.generator.js.parser.JsOptimizer">
			<classpath refid="generator.classpath" />
			<classpath refid="commons.classpath" />

			<arg value="-source:html" />
			<arg path="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript/" />

			<arg value="-dest:html" />
			<arg path="${build}/js_optimizer1-html/org/rcfaces/renderkit/html/internal/javascript" />

			<arg value="-source:svg" />
			<arg path="${build-svg}/src/org/rcfaces/renderkit/svg/internal/javascript/" />

			<arg value="-dest:svg" />
			<arg path="${build}/js_optimizer1-svg/org/rcfaces/renderkit/svg/internal/javascript" />

			<arg value="-extension" />
			<arg value="js" />

			<arg value="-label" />
			<arg value="LEVEL1" />

			<arg value="-version" />
			<arg value="${integration.type}${integrationVersion}" />
		</java>

		<java taskname="OptimizeJs Level2" classname="com.vedana.camelia.generator.js.parser.JsOptimizer">
			<classpath refid="generator.classpath" />
			<classpath refid="commons.classpath" />

			<arg value="-source:html" />
			<arg path="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript/" />

			<arg value="-dest:html" />
			<arg path="${build}/js_optimizer2-html/org/rcfaces/renderkit/html/internal/javascript" />

			<arg value="-source:svg" />
			<arg path="${build-svg}/src/org/rcfaces/renderkit/svg/internal/javascript/" />

			<arg value="-dest:svg" />
			<arg path="${build}/js_optimizer2-svg/org/rcfaces/renderkit/svg/internal/javascript" />

			<arg value="-label" />
			<arg value="LEVEL2" />

			<arg value="-extension" />
			<arg value="js" />

			<arg value="-version" />
			<arg value="${integration.type}${integrationVersion}" />

			<arg value="+mergeVariables" />
			<arg value="+resolveSuper" />
			<arg value="+inlineAspects" />

		</java>

		<java taskname="OptimizeJs Level3" classname="com.vedana.camelia.generator.js.parser.JsOptimizer">
			<classpath refid="generator.classpath" />
			<classpath refid="commons.classpath" />

			<arg value="-source:html" />
			<arg path="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript/" />

			<arg value="-dest:html" />
			<arg path="${build}/js_optimizer3-html/org/rcfaces/renderkit/html/internal/javascript" />

			<arg value="-source:svg" />
			<arg path="${build-svg}/src/org/rcfaces/renderkit/svg/internal/javascript/" />

			<arg value="-dest:svg" />
			<arg path="${build}/js_optimizer3-svg/org/rcfaces/renderkit/svg/internal/javascript" />

			<arg value="-label" />
			<arg value="LEVEL3" />

			<arg value="-extension" />
			<arg value="js" />

			<arg value="-version" />
			<arg value="${integration.type}${integrationVersion}" />

			<arg value="+mergeVariables" />
			<arg value="+resolveSuper" />
			<arg value="+inlineAspects" />
			<arg value="+multiWindow" />

		</java>
	</target>

	<target name="main" unless="builtMain">
		<property name="builtMain" value="true" />

		<antcall target="clean" />

		<delete dir="${dist}/last" failonerror="false" />

		<antcall target="compileJS" />

		<property name="rcfaces-tlddoc.zip" value="${dist}/last/rcfaces-tlddoc.zip" />
		<property name="rcfaces-jsdoc.zip" value="${dist}/last/rcfaces-jsdoc.zip" />
	</target>

	<target name="integration">
		<property name="integration.suffix" value="-${integration.type}${integrationVersion}" />
		<property name="buildNumber.path" value="${dist}/rcfaces${integration.suffix}" />

		<mkdir dir="${buildNumber.path}" />
		<copy todir="${buildNumber.path}">
			<fileset dir="${dist}/last">
				<include name="*.jar" />
			</fileset>
			<mapper type="glob" from="*.jar" to="*${integration.suffix}.jar" />
		</copy>
		<copy todir="${buildNumber.path}">
			<fileset dir="${dist}/last">
				<include name="*.zip" />
			</fileset>
			<mapper type="glob" from="*.zip" to="*${integration.suffix}.zip" />
		</copy>
	</target>

	<target name="last-link">
		<property name="integration.suffix" value="-${integration.type}${integrationVersion}" />
		<property name="buildIntegration.path" value="${dist}/last-versioned" />

		<exec executable="/bin/rm">
			<arg path="${buildIntegration.path}" />
		</exec>

		<exec executable="/bin/ln">
			<arg value="-s" />
			<arg path="${dist}/rcfaces${integration.suffix}" />
			<arg path="${buildIntegration.path}" />
		</exec>
	</target>

	<target name="tlddoc">
		<delete failonerror="false" dir="${build}/camelia-tlddoc" />
		<mkdir dir="${build}/camelia-tlddoc" />
		<java taskname="tlddoc" fork="true" failonerror="true" jar="lib-doc/tlddoc-1.3.jar">
			<arg value="-d" />
			<arg path="${build}/camelia-tlddoc" />
			<arg path="${build}/1_2/bin-core/META-INF/rcfaces-core.tld" />
			<arg path="${build}/1_2/bin-html/META-INF/rcfaces-html.tld" />
		</java>
		<zip destfile="${rcfaces-tlddoc.zip}">
			<fileset dir="${build}/camelia-tlddoc">
			</fileset>
		</zip>
	</target>

	<target name="jsdoc">
		<taskdef name="jsDoc" classname="com.vedana.js.doc.ant.JsDoc">
			<classpath location="lib-doc/jsdoc.jar" />
			<classpath location="lib-doc/jsdoc-ant.jar" />
			<classpath refid="commons.classpath" />
		</taskdef>
		
		<delete failonerror="false" dir="${build}/jsdoc-bootstap" />
		<mkdir dir="${build}/jsdoc-bootstap" />
		
		<unzip dest="${build}/jsdoc-bootstap" src="lib-doc/jsdoc.jar">
			<patternset>
				<include name="com/vedana/js/doc/camelia/*.js"/>
			</patternset>
		</unzip>
		
		<delete failonerror="false" dir="${build}/camelia-jsdoc" />
		<mkdir dir="${build}/camelia-jsdoc" />

		<jsDoc 
				product="camelia" 
				format="html" 
				scope="public" 
				input="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript"
				coreFiles="${build}/jsdoc-bootstap/com/vedana/js/doc/camelia"
				outputDirectory="${build}/camelia-jsdoc/">
		</jsDoc>
		<zip destfile="${rcfaces-jsdoc.zip}">
			<fileset dir="${build}/camelia-jsdoc">
			</fileset>
		</zip>
	</target>
<!--
	<target name="build1_1" depends="main">
		<ant antfile="build-package.xml" target="buildVersion">
			<property name="jsf.version" value="1_1" />
			<property name="jsf.version.manifest" value="1.1" />
			<property name="generator.classname" value="com.vedana.camelia.generator.components_1_1.CameliaGenerator" />
			<property name="version" value="1.1" />
			<property name="minorRelease" value="0" />
		</ant>
	</target>
	-->

	<target name="build1_2" depends="main">
		<ant antfile="build-package.xml" target="buildVersion">
			<property name="jsf.version" value="1_2" />
			<property name="jsf.version.manifest" value="1.2" />
			<property name="generator.classname" value="com.vedana.camelia.generator.components_1_2.CameliaGenerator1_2" />
			<property name="version" value="1.2" />
			<property name="minorRelease" value="0" />
		</ant>
	</target>

	<target name="buildVersion">
		<property name="build.path" value="${dist}/last" />

		<property name="build.version.path" value="${build}/${jsf.version}" />

		<property name="rcfaces-core.jar" value="${build.path}/rcfaces-core-jsf${jsf.version}.jar" />
		<property name="rcfaces-core-src.jar" value="${build.path}/rcfaces-core-src-jsf${jsf.version}.jar" />

		<property name="rcfaces-imageIO.jar" value="${build.path}/rcfaces-imageIO-jsf${jsf.version}.jar" />
		<property name="rcfaces-imageIO-src.jar" value="${build.path}/rcfaces-imageIO-src-jsf${jsf.version}.jar" />		

		<property name="rcfaces-jfreechart.jar" value="${build.path}/rcfaces-jfreechart-jsf${jsf.version}.jar" />
		<property name="rcfaces-jfreechart-src.jar" value="${build.path}/rcfaces-jfreechart-src-jsf${jsf.version}.jar" />		

		<property name="rcfaces-javadoc.zip" value="${build.path}/rcfaces-javadoc-jsf${jsf.version}.zip" />

		<mkdir dir="${build.path}" />

		<delete failonerror="false" dir="${build.version.path}" />

		<mkdir dir="${build.version.path}" />

		<mkdir dir="${build.version.path}/src-core" />
		<mkdir dir="${build.version.path}/bin-core" />

		<mkdir dir="${build.version.path}/src-html" />
		<mkdir dir="${build.version.path}/bin-html" />

		<mkdir dir="${build.version.path}/src-imageIO" />
		<mkdir dir="${build.version.path}/bin-imageIO" />

		<mkdir dir="${build.version.path}/src-jfreechart" />
		<mkdir dir="${build.version.path}/bin-jfreechart" />

		<mkdir dir="${build.version.path}/src-svg" />
		<mkdir dir="${build.version.path}/bin-svg" />

		<copy todir="${build.version.path}/src-core">
			<fileset dir="${build-core}/src">
				<include name="**/*.java" />
				<include name="**/*.properties" />
				<include name="**/*.xml" />
			</fileset>
			<fileset dir="${build-core}/src-jsf${jsf.version}">
				<include name="**/*.java" />
			</fileset>
		</copy>

		<copy todir="${build.version.path}/src-html">
			<fileset dir="${build-html}/src">
				<exclude name="**/*.db" />
				<exclude name="**/*_" />
			</fileset>
			<fileset dir="${build-html}/src-jsf${jsf.version}" />
		</copy>

		<copy todir="${build.version.path}/src-imageIO">
			<fileset dir="${build-imageIO}/src">
				<exclude name="**/*.db" />
				<exclude name="**/*_" />
			</fileset>
		</copy>

		<copy todir="${build.version.path}/src-jfreechart">
			<fileset dir="${build-jfreechart}/src">
				<exclude name="**/*.db" />
				<exclude name="**/*_" />
			</fileset>
		</copy>

		<copy todir="${build.version.path}/src-svg">
			<fileset dir="${build-svg}/src">
				<exclude name="**/*.db" />
				<exclude name="**/*_" />
			</fileset>
		</copy>

		<mkdir dir="${build.version.path}/bin-bootstrap" />

		<path id="generated.classpath">
			<path location="${build.version.path}/bin-bootstrap" />
			<fileset dir="${build-core}/lib">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${build-core}/lib/jsf${jsf.version}">
				<include name="*.jar" />
			</fileset>
		</path>

		<java taskname="Prepare bootStrap" classname="${generator.classname}">
			<classpath refid="generator.classpath" />
			<classpath refid="generated.classpath" />

			<arg value="+template" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.html}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.svg}" />

			<arg value="+classPath" />
			<arg pathref="generated.classpath" />

			<arg value="+bootStrap" />

			<arg value="+renderKit:core" />
			<arg path="${build.version.path}/src-core-bootstrap" />

			<arg value="+renderKit:html" />
			<arg path="${build.version.path}/src-html-bootstrap" />

			<arg value="+renderKit:svg" />
			<arg path="${build.version.path}/src-svg-bootstrap" />

			<arg value="+renderKitPrefix:svg" />
			<arg value="svg" />
		</java>

		<javac taskname="Build bootstrap" debug="true" destdir="${build.version.path}/bin-bootstrap" optimize="no" nowarn="true" failonerror="true" target="${java.target}" encoding="utf-8">

			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
			</classpath>
			<src path="${build.version.path}/src-core" />
			<src path="${build.version.path}/src-core-bootstrap" />
			<src path="${build.version.path}/src-html" />
			<src path="${build.version.path}/src-html-bootstrap" />
			<src path="${build.version.path}/src-svg" />
			<src path="${build.version.path}/src-svg-bootstrap" />

			<include name="org/rcfaces/**/component/**" />
			<include name="org/rcfaces/**/capability/**" />
			<include name="org/rcfaces/**/manager/**" />
			<include name="org/rcfaces/**/event/**" />
			<include name="org/rcfaces/**/model/**" />
		</javac>

		<echo message="Call generator ${generator.classname}" />
		<echo message="  core-model=${metadas.xml.core}" />
		<echo message="  html-model=${metadas.xml.html}" />
		<echo message="  svg-model=${metadas.xml.svg}" />

		<java taskname="Build template" classname="${generator.classname}">
			<classpath refid="generator.classpath" />
			<classpath refid="generated.classpath" />

			<arg value="+template" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.html}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.svg}" />

			<arg value="+classPath" />
			<arg pathref="generated.classpath" />

			<arg value="+renderKit:core" />
			<arg path="${build.version.path}/src-core" />

			<arg value="+renderKit:html" />
			<arg path="${build.version.path}/src-html" />

			<arg value="+renderKit:svg" />
			<arg path="${build.version.path}/src-svg" />

			<arg value="+renderKitPrefix:svg" />
			<arg value="svg" />

			<arg value="+renderKitRender:svg" />
			<arg value="svg" />
		</java>


		<antcall target="core_pass2" />

		<path id="html-classPathId">
			<path path="${build.version.path}/bin-core" />
		</path>
		
		<antcall target="renderkit_pass2">
			<param name="pass.type" value="html"/>
			<param name="pass.build" value="${build-html}"/>
			<param name="pass.classpathId" value="html-classPathId"/>
		</antcall>

		<path id="imageIO-classPathId">
			<path path="${build.version.path}/bin-core" />
		</path>

		<antcall target="imageIO_pass2">
			<param name="pass.build" value="${build-imageIO}"/>
			<param name="pass.classpathId" value="imageIO-classPathId"/>
		</antcall>

		<path id="jfreechart-classPathId">
			<path path="${build.version.path}/bin-core" />
			<path path="${build.version.path}/bin-html" />
			<path path="${build.version.path}/bin-imageIO" />
		</path>

		<antcall target="jfreechart_pass2">
			<param name="pass.build" value="${build-jfreechart}"/>
			<param name="pass.classpathId" value="jfreechart-classPathId"/>
		</antcall>

		<path id="svg-classPathId">
			<path path="${build.version.path}/bin-core" />
			<path path="${build.version.path}/bin-html" />
			<path path="${build.version.path}/bin-imageIO" />
		</path>

		<antcall target="renderkit_pass2">
			<param name="pass.type" value="svg"/>
			<param name="pass.build" value="${build-svg}"/>
			<param name="pass.classpathId" value="svg-classPathId"/>
		</antcall>
	
		<antcall target="javadoc" />
	</target>


	<!-- ############# Le CORE ################# -->
	<target name="core_pass2">

		<replace file="${build.version.path}/src-core/org/rcfaces/core/internal/Constants.java"
			  token="String BUILDER_VERSION = null" 
			  value="String BUILDER_VERSION = &quot;${version}.${minorRelease}.${integrationVersion}&quot;" />

		<javac taskname="Build core" srcdir="${build.version.path}/src-core" debug="true" destdir="${build.version.path}/bin-core" optimize="no" target="${java.target}" encoding="utf-8">
			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javac>

		<copy file="${build-core}/src/META-INF/MANIFEST.MF" toDir="${build.version.path}/src-core/META-INF" overwrite="true" />
		<manifest file="${build.version.path}/src-core/META-INF/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}" />
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${integrationVersion}" />
			<attribute name="Build-Date" value="${TODAY}" />
			<attribute name="JSF-Version" value="${jsf.version.manifest}" />
			<section name="org.rcfaces.core">
			</section>
		</manifest>
	
		<!--
		<move file="${build.version.path}/src-core/org/rcfaces/core/rcfaces-core-facesconfig.xml" tofile="${build.version.path}/src-core/META-INF/faces-config.xml" />
		<move file="${build.version.path}/src-core/org/rcfaces/core/rcfaces-core.taglib.xml" tofile="${build.version.path}/src-core/META-INF/rcfaces-core.taglib.xml" />
		<move file="${build.version.path}/src-core/org/rcfaces/core/rcfaces-core.tld" tofile="${build.version.path}/src-core/META-INF/rcfaces-core.tld" />
		-->
<!--		<copy file="${build-core}/src/org/rcfaces/core/internal/images/ico/javax.imageio.spi.ImageWriterSpi" tofile="${build.version.path}/src-core/META-INF/services/javax.imageio.spi.ImageWriterSpi" /> -->
	
		<copy todir="${build.version.path}/bin-core">
			<fileset dir="${build.version.path}/src-core">
				<exclude name="**/*.java" />
			</fileset>
		</copy>
	
		<delete file="${rcfaces-core.jar}" failonerror="false" />
		<jar destfile="${rcfaces-core.jar}" index="true" manifest="${build.version.path}/bin-core/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-core">
			</fileset>
		</jar>
	
		<delete file="${rcfaces-core-src.jar}" failonerror="false" />
		<jar destfile="${rcfaces-core-src.jar}" index="true" manifest="${build.version.path}/src-core/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/src-core">
			</fileset>
		</jar>
	</target>

	<!-- ############# IMAGEIO ################# -->
	
	<target name="imageIO_pass2">

		<replace file="${build.version.path}/src-imageIO/org/rcfaces/core/internal/images/Constants.java"
			token="String BUILDER_VERSION = null" 
			value="String BUILDER_VERSION = &quot;${version}.${minorRelease}.${integrationVersion}&quot;" />

		<javac taskname="Build imageIO" srcdir="${build.version.path}/src-imageIO" debug="true" destdir="${build.version.path}/bin-imageIO" optimize="no" target="${java.target}" encoding="utf-8">
			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${pass.build}/lib">
					<include name="*.jar" />
				</fileset>
				<path refid="${pass.classpathId}"/>
			</classpath>
		</javac>
	
		<copy file="${build.version.path}/src-imageIO/META-INF/rcfaces-config.xml" 
			  todir="${build.version.path}/bin-imageIO/META-INF" />
		
		<manifest file="${build.version.path}/bin-imageIO/META-INF/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}" />
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${integrationVersion}" />
			<attribute name="Build-Date" value="${TODAY}" />
			<attribute name="JSF-Version" value="${jsf.version.manifest}" />
			<section name="org.rcfaces.image.ImageIO">
			</section>
		</manifest>

		<copy file="${build.version.path}/bin-imageIO/META-INF/MANIFEST.MF" 
			  toDir="${build.version.path}/src-imageIO/META-INF" overwrite="true" />

		<copy file="${build.version.path}/src-imageIO/org/rcfaces/core/internal/images/ico/javax.imageio.spi.ImageWriterSpi" 
			  todir="${build.version.path}/bin-imageIO/META-INF/services" />
	
		<copy todir="${build.version.path}/bin-imageIO">
			<fileset dir="${build.version.path}/src-imageIO">
				<exclude name="**/*.java" />
				<exclude name="**/javax.imageio.spi.ImageWriterSpi" />
				<exclude name="**/rcfaces-config.xml" />
			</fileset>
		</copy>

		<delete file="${rcfaces-imageIO.jar}" failonerror="false" />
		<jar destfile="${rcfaces-imageIO.jar}" index="true" manifest="${build.version.path}/bin-imageIO/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-imageIO">
			</fileset>
		</jar>
	
		<delete file="${rcfaces-imageIO-src.jar}" failonerror="false" />
		<jar destfile="${rcfaces-imageIO-src.jar}" index="true" manifest="${build.version.path}/src-imageIO/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/src-imageIO">
			</fileset>
		</jar>
	</target>


	<!-- ############# JFREECHART ################# -->
	
	<target name="jfreechart_pass2">

		<replace file="${build.version.path}/src-jfreechart/org/rcfaces/jfreechart/internal/Constants.java"
			token="String BUILDER_VERSION = null" 
			value="String BUILDER_VERSION = &quot;${version}.${minorRelease}.${integrationVersion}&quot;" />

		<javac taskname="Build jfreechart" srcdir="${build.version.path}/src-jfreechart" debug="true" destdir="${build.version.path}/bin-jfreechart" optimize="no" target="${java.target}" encoding="utf-8">
			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${pass.build}/lib">
					<include name="*.jar" />
				</fileset>
				<path refid="${pass.classpathId}"/>
			</classpath>
		</javac>
	
		<mkdir dir="${build.version.path}/bin-jfreechart/META-INF"/>
		
		<!--
		<copy file="${build.version.path}/src-jfreechart/META-INF/rcfaces-config.xml" 
			  todir="${build.version.path}/bin-jfreechart/META-INF" />
		-->
		
		<manifest file="${build.version.path}/bin-jfreechart/META-INF/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}" />
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${integrationVersion}" />
			<attribute name="Build-Date" value="${TODAY}" />
			<attribute name="JSF-Version" value="${jsf.version.manifest}" />
			<section name="org.rcfaces.jfreechart">
			</section>
		</manifest>

		<copy file="${build.version.path}/bin-jfreechart/META-INF/MANIFEST.MF" 
			  toDir="${build.version.path}/src-jfreechart/META-INF" overwrite="true" />
	
		<copy todir="${build.version.path}/bin-jfreechart">
			<fileset dir="${build.version.path}/src-jfreechart">
				<exclude name="**/*.java" />
			</fileset>
		</copy>

		<delete file="${rcfaces-jfreechart.jar}" failonerror="false" />
		<jar destfile="${rcfaces-jfreechart.jar}" index="true" manifest="${build.version.path}/bin-jfreechart/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-jfreechart">
			</fileset>
		</jar>
	
		<delete file="${rcfaces-jfreechart-src.jar}" failonerror="false" />
		<jar destfile="${rcfaces-jfreechart-src.jar}" index="true" manifest="${build.version.path}/src-jfreechart/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/src-jfreechart">
			</fileset>
		</jar>
	</target>

	<!-- ############################ LE HTML   ################################## -->

	<target name="renderkit_pass2">
		<echo message="Pass 2 of renderKit ${pass.type}" />
		<mkdir dir="${build.version.path}/bin-${pass.type}c" />

		<!--
		<move file="${build.version.path}/src-${pass.type}/org/rcfaces/renderkit/${pass.type}/rcfaces-${pass.type}-facesconfig.xml" tofile="${build.version.path}/src-${pass.type}/META-INF/faces-config.xml" />
		<move file="${build.version.path}/src-${pass.type}/org/rcfaces/renderkit/${pass.type}/rcfaces-${pass.type}.taglib.xml" tofile="${build.version.path}/src-${pass.type}/META-INF/rcfaces-${pass.type}.taglib.xml" />
		<move file="${build.version.path}/src-${pass.type}/org/rcfaces/renderkit/${pass.type}/rcfaces-${pass.type}.tld" tofile="${build.version.path}/src-${pass.type}/META-INF/rcfaces-${pass.type}.tld" />
		<copy file="${pass.build}/src/org/rcfaces/renderkit/${pass.type}/internal/rcfaces-${pass.type}-config.xml" tofile="${build.version.path}/src-${pass.type}/META-INF/rcfaces-config.xml" />
-->
		
		<replace file="${build.version.path}/src-${pass.type}/org/rcfaces/renderkit/${pass.type}/internal/Constants.java"
			token="String BUILDER_VERSION = null" 
			value="String BUILDER_VERSION = &quot;${version}.${minorRelease}.${integrationVersion}&quot;" />		
		
		<copy file="${pass.build}/src/META-INF/MANIFEST.MF" toDir="${build.version.path}/src-${pass.type}/META-INF" overwrite="true" />
		<manifest file="${build.version.path}/src-${pass.type}/META-INF/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}" />
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${integrationVersion}" />
			<attribute name="Build-Date" value="${TODAY}" />
			<attribute name="JSF-Version" value="${jsf.version.manifest}" />
			<section name="org.rcfaces.renderkit.${pass.type}">
			</section>
		</manifest>

		<javac srcdir="${build.version.path}/src-${pass.type}" debug="true" destdir="${build.version.path}/bin-${pass.type}" optimize="no" target="${java.target}" encoding="utf-8">
			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${pass.build}/lib">
					<include name="*.jar" />
				</fileset>
				<path refid="${pass.classpathId}"/>
			</classpath>
		</javac>

		<copy todir="${build.version.path}/bin-${pass.type}">
			<fileset dir="${build.version.path}/src-${pass.type}">
				<exclude name="**/*.java" />
				<exclude name="**/*.css" />
			</fileset>
		</copy>
		
		<java taskname="processCSS" failonerror="true" classname="org.rcfaces.css.internal.CssSteadyStateParser" fork="true">
			<classpath>
				<path refid="generator.classpath" />
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${pass.build}/lib">
					<include name="*.jar" />
				</fileset>
				<path path="${build.version.path}/bin-core" />
			</classpath>
	
			<arg path="${build.version.path}/bin-${pass.type}/org/rcfaces/renderkit/${pass.type}/internal/css" />
			<arg path="${build.version.path}/src-${pass.type}/org/rcfaces/renderkit/${pass.type}/internal/css" />
		</java>


		<!-- ### le JAR #### -->
		
		<delete file="${build.path}/rcfaces-${pass.type}-jsf${jsf.version}.jar" failonerror="false" />
		<jar destfile="${build.path}/rcfaces-${pass.type}-jsf${jsf.version}.jar" index="true" manifest="${build.version.path}/bin-${pass.type}/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-${pass.type}">
			</fileset>
		</jar>

		<!-- ### le SRC #### -->

		<delete file="${build.path}/rcfaces-${pass.type}-src-jsf${jsf.version}.jar" failonerror="false" />
		<jar destfile="${build.path}/rcfaces-${pass.type}-src-jsf${jsf.version}.jar" index="true" manifest="${build.version.path}/src-${pass.type}/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/src-${pass.type}">
			</fileset>
		</jar>

		<!-- ### le C1 #### -->
		
		<delete file="${build.version.path}/bin-${pass.type}c1" failonerror="false" />
		<copy todir="${build.version.path}/bin-${pass.type}c1" includeemptydirs="no">
			<fileset dir="${build.version.path}/bin-${pass.type}">
				<exclude name="**/*.js" />
				<exclude name="**/symbols" />
				<exclude name="**/*old" />
			</fileset>

			<fileset dir="${build}/js_optimizer1-${pass.type}">
			</fileset>
		</copy>
		<manifest file="${build.version.path}/bin-${pass.type}c1/META-INF/MANIFEST.MF" mode="update">
			<section name="org.rcfaces.renderkit.${pass.type}">
				<attribute name="Rcfaces-Javascript-Level" value="1" />
			</section>
		</manifest>

		<delete file="${build.path}/rcfaces-${pass.type}c-jsf${jsf.version}.jar" failonerror="false" />
		<jar destfile="${build.path}/rcfaces-${pass.type}c-jsf${jsf.version}.jar" index="true" manifest="${build.version.path}/bin-${pass.type}c1/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-${pass.type}c1">
			</fileset>
		</jar>

		<!-- ### le C2 #### -->

		<delete file="${build.version.path}/bin-${pass.type}c2" failonerror="false" />
		<copy todir="${build.version.path}/bin-${pass.type}c2" includeemptydirs="no">
			<fileset dir="${build.version.path}/bin-${pass.type}">
				<exclude name="**/*.js" />
				<exclude name="**/symbols" />
				<exclude name="**/*old" />
			</fileset>

			<fileset dir="${build}/js_optimizer2-${pass.type}">
			</fileset>
		</copy>
		<manifest file="${build.version.path}/bin-${pass.type}c2/META-INF/MANIFEST.MF" mode="update">
			<section name="org.rcfaces.renderkit.${pass.type}">
				<attribute name="Rcfaces-Javascript-Level" value="2" />
			</section>
		</manifest>

		<delete file="${build.path}/rcfaces-${pass.type}c2-jsf${jsf.version}.jar" failonerror="false" />
		<jar destfile="${build.path}/rcfaces-${pass.type}c2-jsf${jsf.version}.jar" index="true" manifest="${build.version.path}/bin-${pass.type}c2/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-${pass.type}c2">
			</fileset>
		</jar>

		<!-- ### le C3 #### -->

		<delete file="{build.version.path}/bin-${pass.type}c3" failonerror="false" />
		<copy todir="${build.version.path}/bin-${pass.type}c3" includeemptydirs="no">
			<fileset dir="${build.version.path}/bin-${pass.type}">
				<exclude name="**/*.js" />
				<exclude name="**/symbols" />
				<exclude name="**/*old" />
			</fileset>

			<fileset dir="${build}/js_optimizer3-${pass.type}">
			</fileset>
		</copy>
		<manifest file="${build.version.path}/bin-${pass.type}c3/META-INF/MANIFEST.MF" mode="update">
			<section name="org.rcfaces.renderkit.${pass.type}">
				<attribute name="Rcfaces-Javascript-Level" value="3" />
			</section>
		</manifest>

		<delete file="${build.path}/rcfaces-${pass.type}c3-jsf${jsf.version}.jar" failonerror="false" />
		<jar destfile="${build.path}/rcfaces-${pass.type}c3-jsf${jsf.version}.jar" index="true" manifest="${build.version.path}/bin-${pass.type}c3/META-INF/MANIFEST.MF">
			<fileset dir="${build.version.path}/bin-${pass.type}c3">
			</fileset>
		</jar>
	</target>


	<!-- ############################ JAVADOC ################################## -->
	<target name="javadoc" unless="no.javadoc">
		<mkdir dir="${build.version.path}/javadoc" />
		<javadoc access="public" encoding="utf-8" author="false" destdir="${build.version.path}/javadoc" doctitle="Rich Client Faces Components" nodeprecated="true" nodeprecatedlist="true" noindex="false" nonavbar="false" notree="false" packagenames="org.rcfaces.core.component.capability,org.rcfaces.core.converter,org.rcfaces.core.component.familly,org.rcfaces.core.component,org.rcfaces.core.component.iterator,org.rcfaces.core.event,org.rcfaces.core.util,org.rcfaces.core.model,org.rcfaces.core.preference,org.rcfaces.core.provider,org.rcfaces.core.progressMonitor,org.rcfaces.core.image,org.rcfaces.core.item,org.rcfaces.core.lang,org.rcfaces.core.lang.provider" source="${java.target}" sourcepath="${build.version.path}/src-core" splitindex="true" use="false" version="false">
			<classpath>
				<fileset dir="${build-core}/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${build-core}/lib/jsf${jsf.version}">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javadoc>
		<zip destfile="${rcfaces-javadoc.zip}">
			<fileset dir="${build.version.path}/javadoc">
			</fileset>
		</zip>
	</target>

	<target name="setupInit">
		<property name="build-core" location="${basedir}/../org.rcfaces.core" />
		<property name="build-html" location="${basedir}/../org.rcfaces.renderkit.html" />
		<property name="build-svg" location="${basedir}/../org.rcfaces.renderkit.svg" />
	</target>

	<!--
	<target name="setup1_1" depends="setupInit">
		<copy file="${build-core}/.classpath-1_1" tofile="${build-core}/.classpath" overwrite="true" />
		<copy file="${build-html}/.classpath-1_1" tofile="${build-html}/.classpath" overwrite="true" />
		<copy file="${build-svg}/.classpath-1_1" tofile="${build-svg}/.classpath" overwrite="true" />
	</target>
	-->

	<target name="setup1_2" depends="setupInit">
		<copy file="${build-core}/.classpath-1_2" tofile="${build-core}/.classpath" overwrite="true" />
		<copy file="${build-html}/.classpath-1_2" tofile="${build-html}/.classpath" overwrite="true" />
		<copy file="${build-svg}/.classpath-1_2" tofile="${build-svg}/.classpath" overwrite="true" />
	</target>

	<target name="copyUnedic">
		<property name="fw3" value="W:/Workspace Unedic/frameworkv3" />
		<property name="css" value="${dist}/../../com.steadystate.css/dist" />
		<property name="js" value="${dist}/../../com.vedana.rhino/dist" />

		<property name="camelia.version" value="I2515" />
		<property name="css.version" value="I3" />
		<property name="js.version" value="I1" />

		<copy file="${dist}/last/rcfaces-core-jsf1_2.jar" tofile="${fw3}/WebContent/WEB-INF/lib/rcfaces-core-jsf1_2.jar" overwrite="true" />
		<copy file="${dist}/last/rcfaces-htmlc3-jsf1_2.jar" tofile="${fw3}/WebContent/WEB-INF/lib/rcfaces-html-jsf1_2.jar" overwrite="true" />
		<copy file="${css}/last/rcfaces-css.jar" tofile="${fw3}/WebContent/WEB-INF/lib/rcfaces-css.jar" overwrite="true" />
		<copy file="${js}/last/rcfaces-js-symbols.jar" tofile="${fw3}/WebContent/WEB-INF/lib/rcfaces-js-symbols.jar" overwrite="true" />

		<copy file="${dist}/rcfaces-${camelia.version}/rcfaces-core-jsf1_2-${camelia.version}.jar" tofile="${fw3}/lib/rcfaces-core-jsf1_2-${camelia.version}.jar" />
		<copy file="${dist}/rcfaces-${camelia.version}/rcfaces-html-jsf1_2-${camelia.version}.jar" tofile="${fw3}/lib/rcfaces-html-jsf1_2-${camelia.version}.jar" />
		<copy file="${dist}/rcfaces-${camelia.version}/rcfaces-htmlc3-jsf1_2-${camelia.version}.jar" tofile="${fw3}/lib/rcfaces-htmlc3-jsf1_2-${camelia.version}.jar" />
		<copy file="${css}/rcfaces-css-${css.version}/rcfaces-css-${css.version}.jar" tofile="${fw3}/lib/rcfaces-css-${css.version}.jar" />
		<copy file="${js}/rcfaces-js-symbols-${js.version}/rcfaces-js-symbols-${js.version}.jar" tofile="${fw3}/lib/rcfaces-js-symbols-${js.version}.jar" />
	</target>


	<target name="sloop">
		<property name="build-core" location="${basedir}/../org.rcfaces.core" />
		<property name="build-html" location="${basedir}/../org.rcfaces.renderkit.html" />
		<property name="spool.workspace" location="/data/products/rcfaces/Builder/camelia" />

		<!--
		<delete dir="${spool.workspace}" failonerror="false" />		
		<mkdir dir="${spool.workspace}"/>

		<scp todir="${ssh.user}@cvs.vedana.com:/data/products/rcfaces/Builder/camelia/workspace"  verbose="true" keyfile="${ssh.keyfile}" passphrase="${ssh.passphrase}" knownhosts="C:\Users\oeuillot\ssh\known_hosts">
		-->  

		<copy todir="k:/camelia/workspace" verbose="true">
			<fileset dir="${build-core}/..">
				<include name="org.rcfaces.core/src/**" />
				<include name="org.rcfaces.core/src-jsf1_2/**" />
				<include name="org.rcfaces.core/metadatas/**" />
				<include name="org.rcfaces.core/META-INF/**" />
				<include name="org.rcfaces.core/lib/**" />

				<include name="org.rcfaces.renderkit.html/src/**" />
				<include name="org.rcfaces.renderkit.html/src-jsf1_2/**" />
				<include name="org.rcfaces.renderkit.html/META-INF/**" />
				<include name="org.rcfaces.renderkit.html/lib/**" />
				<include name="org.rcfaces.renderkit.html/metadatas/**" />

				<include name="org.rcfaces.renderkit.svg/src/**" />
				<include name="org.rcfaces.renderkit.svg/META-INF/**" />
				<include name="org.rcfaces.renderkit.svg/lib/**" />
				<include name="org.rcfaces.renderkit.svg/metadatas/**" />

				<include name="org.rcfaces.image.imageIO/src/**" />
				<include name="org.rcfaces.image.imageIO/META-INF/**" />
				<include name="org.rcfaces.image.imageIO/lib/**" />
				<include name="org.rcfaces.image.imageIO/metadatas/**" />

				<include name="org.rcfaces.jfreechart/src/**" />
				<include name="org.rcfaces.jfreechart/META-INF/**" />
				<include name="org.rcfaces.jfreechart/lib/**" />
				<include name="org.rcfaces.jfreechart/metadatas/**" />

				<include name="org.rcfaces.packager/lib*/**" />
				<include name="org.rcfaces.packager/*.xml" />
			</fileset>
		</copy>

	</target>

	<target name="cvsco">
		
		<echo message="Utilise le tag CVS '${cvstag}' ." />

		<cvs dest=".." cvsroot="/data/cvs/camelia">
			<commandline>
				<argument value="co"/>
				<argument value="-R"/>
				<argument value="-r"/>
				<argument value="${cvstag}"/>

				<argument value="org.rcfaces.core/src" />
				<argument value="org.rcfaces.core/src-jsf1_2" />
				<argument value="org.rcfaces.core/metadatas" />
				<argument value="org.rcfaces.core/META-INF" />
				<argument value="org.rcfaces.core/lib" />

				<argument value="org.rcfaces.renderkit.html/src" />
				<argument value="org.rcfaces.renderkit.html/src-jsf1_2" />
				<argument value="org.rcfaces.renderkit.html/META-INF" />
				<argument value="org.rcfaces.renderkit.html/lib" />
				<argument value="org.rcfaces.renderkit.html/metadatas" />

				<argument value="org.rcfaces.renderkit.svg/src" />
				<argument value="org.rcfaces.renderkit.svg/META-INF" />
				<argument value="org.rcfaces.renderkit.svg/lib" />
				<argument value="org.rcfaces.renderkit.svg/metadatas" />

				<argument value="org.rcfaces.image.imageIO/src" />
				<argument value="org.rcfaces.image.imageIO/META-INF" />
				<argument value="org.rcfaces.image.imageIO/lib" />
				<argument value="org.rcfaces.image.imageIO/metadatas" />

				<argument value="org.rcfaces.jfreechart/src" />
				<argument value="org.rcfaces.jfreechart/META-INF" />
				<argument value="org.rcfaces.jfreechart/lib" />
				<argument value="org.rcfaces.jfreechart/metadatas" />

				<argument value="org.rcfaces.packager/lib" />
				<argument value="org.rcfaces.packager/lib-doc" />
				<argument value="org.rcfaces.packager/lib-generator" />
			</commandline>
		</cvs>

	</target>
	
	<target name="makebuildid">

		<tstamp>
			<format property="build.number" pattern="yyyyMMddHHmm" locale="fr" />
		</tstamp>
		
		<echo message="BuildId:   M${build.number}" />

	</target>
	
	<target name="localMakeComponent">
		<property name="jsf.version" value="1_2" />
		<property name="base-core" location="${basedir}/../org.rcfaces.core" />
		<property name="base-html" location="${basedir}/../org.rcfaces.renderkit.html" />
		<property name="base-imageIO" location="${basedir}/../org.rcfaces.image.imageIO" />
		<property name="base-svg" location="${basedir}/../org.rcfaces.renderkit.svg" />
		<property name="base-jfreechart" location="${basedir}/../org.rcfaces.jfreechart" />

		<property name="metadas.xml.core" location="${base-core}/metadatas" />
		<property name="metadas.xml.html" location="${base-html}/metadatas" />
		<property name="metadas.xml.svg" location="${base-svg}/metadatas" />

		<property name="generator.classname" value="com.vedana.camelia.generator.components_1_2.CameliaGenerator1_2" />

		<path id="generated.classpath">
			<path location="${base-core}/bin" />
			<path location="${base-html}/bin" />
			<path location="${base-imageIO}/bin" />
			<path location="${base-svg}/bin" />
			<path location="${base-jfreechart}/bin" />

			<fileset dir="${base-core}/lib">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${base-core}/lib/jsf${jsf.version}">
				<include name="*.jar" />
			</fileset>
		</path>

		
		<java taskname="Build template" classname="${generator.classname}">
			<classpath refid="generator.classpath" />
			<classpath refid="generated.classpath" />

			<arg value="+template" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.core}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.html}" />

			<arg value="+repository" />
			<arg path="${metadas.xml.svg}" />

			<arg value="+classPath" />
			<arg pathref="generated.classpath" />

			<arg value="+renderKit:core" />
			<arg path="${base-core}/src-jsf${jsf.version}-generated" />

			<arg value="+renderKit:html" />
			<arg path="${base-html}/src-jsf${jsf.version}-generated" />

			<arg value="+renderKit:svg" />
			<arg path="${base-svg}/src-jsf${jsf.version}-generated" />

			<arg value="+renderKitPrefix:svg" />
			<arg value="svg" />
		</java>
		
		<eclipse.refreshLocal resource="${base-core}/src-jsf${jsf.version}-generated" depth="infinite" />
		<eclipse.refreshLocal resource="${base-html}/src-jsf${jsf.version}-generated" depth="infinite" />
		<eclipse.refreshLocal resource="${base-svg}/src-jsf${jsf.version}-generated" depth="infinite" />
		
	</target>

</project>