<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="Package Camelia" default="main" basedir=".">

  <property name="version" value="1.0" />
  <property name="minorRelease" value="0" />
  <property name="dist"  value="${basedir}/dist"/>
  <property name="build"  value="${basedir}/build"/>
  <property name="build-core"  value="${basedir}/../org.rcfaces.core"/>
  <property name="build-html"  value="${basedir}/../org.rcfaces.renderkit.html"/>
  <property name="cdn_dir"  value="${basedir}/../CDN_POC"/>
  <property name="demo_dir"  value="${basedir}/../Demo JSF-Camelia"/>
  <property name="starter_demo_dir"  value="${basedir}/../Camelia Starter"/>
	
	<property name="CVSROOT" value=":extssh:oeuillot@cvs.vedana.com/data/cvs/camelia" />
	<property name="sf.version" value="1.0b2" />
	
	<target name="clean">
		<delete file="${dist}/rcfaces*.jar" />		
		 <delete>
		    <fileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript" includes="**/*.jsc,symbolsc,symbols"/>
		    <fileset dir="${build-html}/bin/org/rcfaces/renderkit/html/internal/javascript" includes="**/*.jsc,symbolsc,symbols"/>
		  </delete>
	</target>

	<target name="compileJS" >
		<java classname="com.vedana.camelia.generator.js.parser.Test">
			<classpath path="../com.vedana.camelia.generators/bin" />
			<classpath path="../com.vedana.rhino/bin" />
			<classpath path="../com.vedana.camelia.generators/lib-generator/normalizer.jar" />
			<classpath path="../com.vedana.camelia.generators/lib-generator/xercesImpl.jar" />
			<classpath path="../com.vedana.camelia.generators/lib-generator/xmlParserAPIs.jar" />
			<classpath path="../com.vedana.camelia.generators/lib-generator/xom-1.0d19.jar" />
			<classpath path="../JWSDP 1.3/lib/commons-logging.jar" />
			<classpath path="../JWSDP 1.3/lib/commons-digester.jar" />
			<classpath path="../JWSDP 1.3/lib/commons-collections.jar" />
		</java>
 	</target>

	<target name="main" unless="built">
		<property name="built" value="true"/>

		<antcall target="clean" />
		<antcall target="compileJS" />
		
		<echo message="dir ${dist}" />
		<buildnumber file="${dist}/build-number"/>
		<tstamp>
			<format property="TODAY" pattern="dd/MM/yyyy HH:mm " locale="fr"/>
		</tstamp>

		<property name="build.path" value="${dist}/last" />
	
		<property name="rcfaces-core.jar" value="${build.path}/rcfaces-core.jar" />
		<property name="rcfaces-core-src.jar" value="${build.path}/rcfaces-core-src.jar" />		
		<property name="rcfaces-html.jar" value="${build.path}/rcfaces-html.jar" />
		<property name="rcfaces-htmlc.jar" value="${build.path}/rcfaces-htmlc.jar" />
		<property name="rcfaces-html-src.jar" value="${build.path}/rcfaces-html-src.jar" />
		<property name="rcfaces-jsdoc.zip" value="${build.path}/rcfaces-jsdoc.zip" />
		<property name="rcfaces-javadoc.zip" value="${build.path}/rcfaces-javadoc.zip" />
		<property name="rcfaces-tlddoc.zip" value="${build.path}/rcfaces-tlddoc.zip" />
		
		<delete failonerror="false" dir="${build.path}" />
		<mkdir dir="${build.path}"/>

		<copy file="${build-core}/META-INF/MANIFEST.MF" toDir="${dist}" overwrite="true"/>
		<manifest file="${dist}/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}"/> 
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${build.number}"/> 
	    	<attribute name="Build-Date" value="${TODAY}"/>
			<section name="org.rcfaces.core">
			</section>
		</manifest>
		<delete file="${rcfaces-core.jar}" failonerror="false" />
		<jar destfile="${rcfaces-core.jar}" index="true" manifest="${dist}/MANIFEST.MF">
			<fileset dir="${build-core}/bin">
				<exclude name="org/rcfaces/core/*.tld"/>
				<exclude name="org/rcfaces/core/*.xml"/>
				<exclude name="org/rcfaces/core/internal/images/ico/javax.imageio.spi*"/>
				<exclude name="**/*.db"/>
				<exclude name="**/*_"/>
			</fileset>
			<zipfileset dir="${build-core}/bin/org/rcfaces/core/" includes="rcfaces-core-facesconfig.xml" fullpath="META-INF/faces-config.xml"/>
			<zipfileset dir="${build-core}/bin/org/rcfaces/core/" includes="rcfaces-core.taglib.xml" fullpath="META-INF/rcfaces-core.taglib.xml"/>
			<zipfileset dir="${build-core}/bin/org/rcfaces/core/" includes="rcfaces-core.tld" fullpath="META-INF/rcfaces-core.tld"/>
			<zipfileset dir="${build-core}/bin/org/rcfaces/core/internal/images/ico" includes="javax.imageio.spi.ImageWriterSpi" fullpath="META-INF/services/javax.imageio.spi.ImageWriterSpi"/>
		</jar>
		
		<delete file="${rcfaces-core-src.jar}" failonerror="false" />
		<jar destfile="${rcfaces-core-src.jar}" index="true" manifest="${dist}/MANIFEST.MF">
			<fileset dir="${build-core}/src">
				<exclude name="org/rcfaces/core/*.tld"/>
				<exclude name="org/rcfaces/core/*.xml"/>
				<exclude name="org/rcfaces/core/internal/images/ico/javax.imageio.spi*"/>
				<exclude name="**/*.db"/>
				<exclude name="**/*_"/>
			</fileset>
			<zipfileset dir="${build-core}/src/org/rcfaces/core/" includes="rcfaces-core-facesconfig.xml" fullpath="META-INF/faces-config.xml"/>
			<zipfileset dir="${build-core}/src/org/rcfaces/core/" includes="rcfaces-core.taglib.xml" fullpath="META-INF/rcfaces-core.taglib.xml"/>
			<zipfileset dir="${build-core}/src/org/rcfaces/core/" includes="rcfaces-core.tld" fullpath="META-INF/rcfaces-core.tld"/>
			<zipfileset dir="${build-core}/src/org/rcfaces/core/internal/images/ico" includes="javax.imageio.spi.ImageWriterSpi" fullpath="META-INF/services/javax.imageio.spi.ImageWriterSpi"/>
		</jar>
		
		<copy file="${build-html}/META-INF/MANIFEST.MF" toDir="${dist}" overwrite="true"/>
		<manifest file="${dist}/MANIFEST.MF" mode="update">
			<attribute name="Specification-Version" value="${version}"/> 
			<attribute name="Implementation-Version" value="${version}.${minorRelease}.${build.number}"/> 
	    	<attribute name="Build-Date" value="${TODAY}"/>
			<section name="org.rcfaces.renderkit.html">
			</section>
		</manifest>
		<delete file="${rcfaces-html.jar}" failonerror="false" />
		<jar destfile="${rcfaces-html.jar}" index="true" manifest="${dist}/MANIFEST.MF">
			<fileset dir="${build-html}/bin">
				<exclude name="org/rcfaces/renderkit/html/*.tld"/>
				<exclude name="org/rcfaces/renderkit/html/*.xml"/>
				<exclude name="**/symbolsc"/>
				<exclude name="**/symbols"/>
				<exclude name="**/*.jsc"/>
				<exclude name="**/*.db"/>
				<exclude name="**/*_"/>
			</fileset>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html-facesconfig.xml" fullpath="META-INF/faces-config.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.taglib.xml" fullpath="META-INF/rcfaces-html.taglib.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.tld" fullpath="META-INF/rcfaces-html.tld"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal" includes="rcfaces-html-config.xml" fullpath="META-INF/rcfaces-config.xml"/>
		</jar>

		<delete file="${rcfaces-html-src.jar}" failonerror="false" />
		<jar destfile="${rcfaces-html-src.jar}" index="true" manifest="${dist}/MANIFEST.MF">
			<fileset dir="${build-html}/src">
				<exclude name="org/rcfaces/renderkit/html/*.tld"/>
				<exclude name="org/rcfaces/renderkit/html/*.xml"/>
				<exclude name="**/symbolsc"/>
				<exclude name="**/symbols"/>
				<exclude name="**/*.db"/>
				<exclude name="**/*.jsc"/>
				<exclude name="**/*_"/>
			</fileset>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html-facesconfig.xml" fullpath="META-INF/faces-config.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.tld" fullpath="META-INF/rcfaces-html.tld"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.taglib.xml" fullpath="META-INF/rcfaces-html.taglib.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal" includes="rcfaces-html-config.xml" fullpath="META-INF/rcfaces-config.xml"/>
		</jar>

		<delete dir="${build}/js-temp" failonerror="false" />
		<mkdir dir="${build}/js-temp"/>
		<copy todir="${build}/js-temp">
			<fileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript">
				<include name="**/*.jsc"/>
				<include name="symbols"/>
			</fileset>
			<mapper type="glob" from="*.jsc" to="*.js"/>
		</copy>
		<delete file="${rcfaces-htmlc.jar}" failonerror="false" />
		<jar destfile="${rcfaces-htmlc.jar}" index="true" manifest="${dist}/MANIFEST.MF">
			<fileset dir="${build-html}/bin">
				<exclude name="org/rcfaces/renderkit/html/*.tld"/>
				<exclude name="org/rcfaces/renderkit/html/*.xml"/>
				<exclude name="**/symbolsc"/> <!-- A choisir avec ou sans c -->
				<exclude name="**/*.js"/>
				<exclude name="**/*.jsc"/>
				<exclude name="**/*.db"/>
				<exclude name="**/*_"/>
			</fileset>
			<zipfileset dir="${build}/js-temp" includes="**/*.js" prefix="org/rcfaces/renderkit/html/internal/javascript/"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript" includes="symbols" prefix="org/rcfaces/renderkit/html/internal/javascript/"/>
			
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html-facesconfig.xml" fullpath="META-INF/faces-config.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.tld" fullpath="META-INF/rcfaces-html.tld"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html" includes="rcfaces-html.taglib.xml" fullpath="META-INF/rcfaces-html.taglib.xml"/>
			<zipfileset dir="${build-html}/src/org/rcfaces/renderkit/html/internal" includes="rcfaces-html-config.xml" fullpath="META-INF/rcfaces-config.xml"/>
		</jar>
		<delete dir="${build}/js-temp"/>
		<delete file="${dist}/MANIFEST.MF" />
		
	</target>
	
	<target name="integration">
		<property name="integration.version" value="-I${build.number}" />
		<property name="buildNumber.path" value="${dist}/rcfaces${integration.version}" />

		<mkdir dir="${buildNumber.path}"/>
		<copy todir="${buildNumber.path}">
			<fileset dir="${build.path}">
				<include name="*.jar"/>
			</fileset>
			<mapper type="glob" from="*.jar" to="*${integration.version}.jar"/>
		</copy>
		<copy todir="${buildNumber.path}">
			<fileset dir="${build.path}">
				<include name="*.zip"/>
			</fileset>
			<mapper type="glob" from="*.zip" to="*${integration.version}.zip"/>
		</copy>
	</target>
	
	<target name="tlddoc">
		<delete failonerror="false" dir="c:/temp/camelia_tlddoc" />
		<mkdir dir="c:/temp/camelia_tlddoc" />
		<java classname="com.sun.tlddoc.TLDDoc">
			<arg value="-d"/>
			<arg path="c:/temp/camelia_tlddoc"/>
			<arg path="${build-core}/src/org/rcfaces/core/rcfaces-core.tld"/>
			<arg path="${build-html}/src/org/rcfaces/renderkit/html/rcfaces-html.tld"/>
		 </java>
		<zip destfile="${rcfaces-tlddoc.zip}">
			<fileset dir="c:/temp/camelia_tlddoc">
			</fileset>
		</zip>
	</target>
	
	<target name="javadoc">
		<delete failonerror="false">
			<fileset dir="C:/temp/camelia-javadoc">
				<include name="*"/>
			</fileset>
		</delete>
		<mkdir dir="C:/temp/camelia-javadoc" />
		<javadoc access="public" 
				author="false" 
				classpath="../JWSDP 1.3/lib/jsp-api.jar;../JWSDP 1.3/lib/commons-logging.jar;../JWSDP 1.3/lib/commons-beanutils.jar;../jsf-1_1_01/bin;../JWSDP 1.3/lib/standard.jar;../JWSDP 1.3/lib/jstl.jar;../JWSDP 1.3/lib/commons-digester.jar;../JWSDP 1.3/lib/commons-collections.jar;../JWSDP 1.3/lib/servlet-api.jar;../org.rcfaces.core/lib/jsf-facelets.jar" 
				destdir="C:/temp/camelia-javadoc/" 
				doctitle="Rich Client Faces Components" 
				nodeprecated="true" 
				nodeprecatedlist="true" 
				noindex="false" 
				nonavbar="false" 
				notree="false" 
				packagenames="org.rcfaces.core.component.capability,org.rcfaces.core.converter,org.rcfaces.core.component.familly,org.rcfaces.core.component,org.rcfaces.core.component.iterator,org.rcfaces.core.event,org.rcfaces.core.util,org.rcfaces.core.model,org.rcfaces.core.preference,org.rcfaces.core.provider,org.rcfaces.core.progressMonitor,org.rcfaces.core.image,org.rcfaces.core.item,org.rcfaces.core.lang,org.rcfaces.core.lang.provider" 
				source="1.4" 
				sourcepath="${build-core}/src" 
				splitindex="true" 
				use="false" 
				version="false"/>
		<zip destfile="${rcfaces-javadoc.zip}">
			<fileset dir="C:/temp/camelia-javadoc/">
			</fileset>
		</zip>
	</target>
	
	<target name="jsdoc">
		<taskdef name="jsDoc" classname="com.vedana.js.doc.ant.JsDoc"/>
		<delete failonerror="false">
			<fileset dir="c:/temp/camelia-jsdoc">
				<include name="*"/>
			</fileset>
		</delete>
		<mkdir dir="c:/temp/camelia-jsdoc" />
		<jsDoc 
		  	product="camelia" 
		  	format="html"
			scope="public"
		  	input="${build-html}/src/org/rcfaces/renderkit/html/internal/javascript"
		  	outputDirectory="C:/temp/camelia-jsdoc/">
		</jsDoc>
		<zip destfile="${rcfaces-jsdoc.zip}">
			<fileset dir="c:/temp/camelia-jsdoc">
			</fileset>
		</zip>
	</target>
	
	<target name="copyCMS">
		<ftp password="FileRec18" 
				verbose="true"
				passive="true"
				server="cms.vedana.com" 
				userid="cms" 
				remotedir="/httpsdocs/filestorage/camelia/Build ${build.number}"
			action="mkdir" />
		<ftp password="FileRec18" 
				verbose="true"
				passive="true"
				server="cms.vedana.com" 
				userid="cms" 
				remotedir="/httpsdocs/filestorage/camelia/Build ${build.number}"
				action="send">
			<fileset dir="${dist}/rcfaces-b${build.number}">
				<include name="*"/>
			</fileset>
		</ftp>
	</target>
	
	<target name="sf">
			<zip destfile="rcfaces-${sf.version}/RCFaces_bin_v${sf.version}.zip">
				<zipfileset file="rcfaces-${sf.version}/rcfaces-core.jar" fullpath="rcfaces-core.jar" />
				<zipfileset file="rcfaces-${sf.version}/rcfaces-htmlc.jar" fullpath="rcfaces-htmlc.jar" />
			</zip>
		<zip destfile="rcfaces-${sf.version}/RCFaces_dev_v${sf.version}.zip">
			<zipfileset file="rcfaces-${sf.version}/rcfaces-core.jar" fullpath="rcfaces-core.jar" />
			<zipfileset file="rcfaces-${sf.version}/rcfaces-html.jar" fullpath="rcfaces-html.jar" />
		</zip>
		<zip destfile="rcfaces-${sf.version}/RCFaces_src_v${sf.version}.zip">
			<zipfileset file="rcfaces-${sf.version}/rcfaces-core-src.jar" fullpath="rcfaces-core-src.jar" />
			<zipfileset file="rcfaces-${sf.version}/rcfaces-html-src.jar" fullpath="rcfaces-html-src.jar" />
		</zip>
	</target>

	<target name="cvs" depends="main">
		<cvs dest="${build-core}/src" command="tag" noexec="true" cvsRoot="${cvs.root}" tag="${sf.version}"></cvs>
		<cvs dest="${build-html}/src" command="tag" noexec="true" cvsRoot="${cvs.root}" tag="${sf.version}"></cvs>
	</target>
	
	
	<target name="pim" depends="main">
		<copy file="${dist}/rcfaces.jar" toDir="w:/Runtime PIM2/PIM sample/webApplication/WEB-INF/lib" />
		<copy file="${dist}/rcfaces.jar" toDir="w:/Runtime PIM2/CMS sample/webApplication/WEB-INF/lib" />
		<copy file="${dist}/rcfaces.jar" toDir="w:/Runtime PIM2/LDAP sample/webApplication/WEB-INF/lib" />
	</target>

	<target name="addressbook" depends="main">
		<copy file="${dist}/rcfaces-prod.jar" toDir="w:/Runtime PIM2/LDAP sample/webApplication/WEB-INF/lib" />
		<copy file="${dist}/rcfaces-prod.jar" toDir="w:/Runtime PIM2/Camelia Starter/webApplication/WEB-INF/lib" />
		<copy file="${dist}/rcfaces-prod.jar" toDir="w:/Runtime PIM2/Camelia Blank Project/webApplication/WEB-INF/lib" />
	</target>

	<target name="unedic" depends="main">
		<copy file="${dist}/rcfaces-prod.jar" toDir="W:/Workspace Unedic/Dude faces/PortailWeb/portailWeb/WEB-INF/lib" />
		<copy file="${dist}/rcfaces-prod.jar" toDir="W:/Workspace Unedic/Dossier faces/webApplication/WEB-INF/lib" />
	</target>	
</project>